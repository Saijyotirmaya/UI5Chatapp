<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:suite="sap.suite.ui.commons"
    xmlns:form="sap.ui.layout.form"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:u="sap.ui.unified"
>
    <Dialog
        id="chatDialog"
        class="sapUiResponsivePadding"
        stretch="true"
        draggable="true"
        resizable="true"
        contentWidth="300px"
        contentHeight="500px"
        showHeader="false"
    >
        <SplitApp id="splitApp">
            <!-- Master Page -->
            <masterPages>
                <Page id="masterPage1">
                    <content>
             
                        <VBox
                            class="sapUiSmallMargin sapUiResponsiveMargin"
                            width="100%"
                        >
                          
                                <Input
                                    placeholder="Search Name's"
                                    submit="changeName"
                                    liveChange="onFilterName"
                                    width="100%"
                                />

                            <List
                                id="groupsList1"
                                items="{chat>/combinedList}"
                                class="sapUiResponsivePadding"
                                showSeparators="None"
                            >
                                <StandardListItem
                                    title="{chat>title}   ({chat>employeeid})"
                                    icon="{parts:['chat>icon', 'chat>gender' ], formatter: '.Formatter.getImageSrc'}"
                                    type="Navigation"
                                    press="onListItemPress"
                                    class="roundIcon"
                                />
                            </List>
                        </VBox>
                    </content>
                </Page>
            </masterPages>

            <!-- Detail Page -->
           <detailPages>
                <Page id="detailPage">
                    <customHeader>
                        <Bar>
                              <contentMiddle>
                                 <HBox alignItems="Center" renderType="Bare"> 
                          <Image
    id="receiverPic"
    src="{chat>/currentReceiverPic}"
    class="sapUiTinyMarginEnd roundIcon"
    height="2rem"
    width="2rem"
  />
  <Link 
    id="headerTitle" 
    text="{chat>/currentReceiverName}" 
    class="Receivername customLinkStyle" 
    press="On_OpenOverview" 
  />
</HBox>

                              </contentMiddle>
                            <contentRight>
                             <Button
                                    icon="sap-icon://collaborate"
                                    text="Group"
                                    press="onOpenGroupChatDialog"
                                    class="sapUiTinyMargin"
                                />
                                <Button
                                    icon="sap-icon://menu"
                                    press="onMenuPress"
                                    tooltip="Menu"
                                />
                                <Button
                                    icon="sap-icon://video"
                                    press="onVideoCallPress"
                                    tooltip="Make a Video call"
                                />
                                <Button
                                    icon="sap-icon://call"
                                    press="onCallPress"
                                    tooltip="Make a call"
                                />
                                <Button
                                    icon="sap-icon://decline"
                                    press="onCloseDialog"
                                    tooltip="Close"
                                />
                            </contentRight>
                        </Bar>
                    </customHeader>

                    <content>
                        <ScrollContainer
                            id="chatScrollContainer"
                            width="100%"
                            height="85%"
                            horizontal="false"
                            vertical="true"
                            class="sapUiTinyMarginBottom"
                        >   
                            <List
                                id="chatList"
                                items="{chat>/messages}"
                                showSeparators="None"
                                width="100%"
                            >
                                <CustomListItem>
                                     <VBox
                                        width="100%"
                                        class="sapUiTinyMarginBottom"
                                    >
                                        <HBox
                                            justifyContent="{= ${chat>sender} === 'me' ? 'End' : 'Start'}"
                                            width="100%"
                                            class="hoverContainer"
                                        >
                                            <core:Icon
                                                src="sap-icon://slim-arrow-down"
                                                class="hoverIcon"
                                                visible="{= ${chat>sender} === 'me'}"
                                                press="onIconPress"
                                            />
                                            <VBox
                                                class="chatBubble "
                                                alignItems="{= ${chat>sender} === 'me' ? 'End' : 'Start'}"
                                                width="auto"
                                            >
                                                <core:HTML
                                                    content="{path: 'chat>attachment', formatter: '.formatAttachmentHTML'}"
                                                    visible="{= !!${chat>attachment/preview} }"
                                                />

                                                <HBox
                                                    visible="{= !!${chat>attachment} }"
                                                    class="sapUiTinyMarginTop "
                                                >
                                                    <Image
                                                        src="{chat>attachment/preview}"
                                                        visible="{= Boolean(${chat>attachment/type} || ${chat>attachment/type}.startsWith('image/')) }"
                                                        class="chatImagePreview"
                                                        press="onAttachmentPress"
                                                    >
                                                   
                                                        <customData>
                                                            <core:CustomData
                                                                key="url"
                                                                value="{chat>attachment/preview}"
                                                                writeToDom="false"
                                                            />
                                                            <core:CustomData
                                                                key="name"
                                                                value="{chat>attachment/name}"
                                                                writeToDom="false"
                                                            />
                                                        </customData>
                                                    </Image>
                                                    <HBox
                                 visible="{= ${chat>attachment/type} === 'application/pdf' }"
                                 class="sapUiSmallMarginBegin"
                                            >
                                               <Button
                                       type="Transparent"
                                       icon="sap-icon://pdf-attachment"
                                       text="{chat>attachment/name}"
                                       press="onAttachmentPress"
                                       >
                                       <customData>
                                           <core:CustomData key="url" value="{chat>attachment/preview}" writeToDom="false" />
                                           <core:CustomData key="name" value="{chat>attachment/name}" writeToDom="false" />
                                       </customData>
                                   </Button>
                               </HBox>

                                                   
                                                </HBox>
                                                <FormattedText
                                              htmlText="{path: 'chat>text', formatter: '.Formatter.formatMessageText'}"
                                               width="100%"
                                             class="formattedText"
                                               />
                                                <Text
                                                    text="{chat>time}"
                                                    class="sapUiTinyMarginTop sapUiSmallText"
                                                />
                                            </VBox>

                                            <HBox
  visible="{= !!${chat>attachment} &amp;&amp; ${chat>attachment/type} &amp;&amp; ${chat>attachment/type}.startsWith('audio/') }"
  justifyContent="{= ${chat>sender} === 'me' ? 'End' : 'Start'}"
  width="100%">
  <VBox class="chatBubble"
        alignItems="{= ${chat>sender} === 'me' ? 'End' : 'Start'}"
        width="auto"
        visible="{= !!${chat>attachment} &amp;&amp; ${chat>attachment/type} &amp;&amp; ${chat>attachment/type}.startsWith('audio/') }">
    <core:HTML
      content="&lt;audio controls style='height:2.5rem;width:14rem;' preload='none'&gt;
                 &lt;source src='{chat&gt;attachment/preview}' type='{chat&gt;attachment/type}' /&gt;
                 Your browser does not support the audio element.
               &lt;/audio&gt; &lt;/video&gt;" />
  </VBox>
</HBox>

                                        <core:Icon
                                                src="sap-icon://slim-arrow-down"
                                                class="hoverIcon"
                                                visible="{= ${chat>sender} === 'them' }"
                                                press="onIconPress"
                                            />
                                        </HBox>
                                    </VBox>
                                </CustomListItem>
                            </List>
                        </ScrollContainer>

                        <!-- Message Input and File Upload -->
                        <Toolbar
                            width="100%"
                            class="messageInputToolbar sapUiTinyMarginBottom"
                            xmlns:core="sap.ui.core"
                            xmlns:u="sap.ui.unified"
                        >
                            <u:FileUploader
                                id="attachmentUploader"
                                fileType="pdf,jpg,jpeg,mp4,svg,png,doc,docx,xls,xlsx,ppt,pptx,txt"
                                multiple="false"
                                tooltip="Attach file"
                                buttonOnly="true"
                                icon="sap-icon://attachment"
                                iconOnly="true"
                                change="onFileChange"
                                enabled="{= !!${chat>/current_room}}"
                            />

                          
                            <Button
                                icon="sap-icon://add"
                                tooltip="Insert Emoji"
                                press="onEmojiPress"
                                enabled="{= !!${chat>/current_room}}"
                            />
                             <Button
                                icon="sap-icon://marketing-campaign"
                                tooltip="Speech to Text"
                                press="onVoiceMessagePress"
                                type="Emphasized"
                                enabled="{= !!${chat>/current_room}}"
                            />
                            

                            <TextArea
                                id="messageInput1"
                                growing="true"
                                growingMaxLines="4"
                                rows="2"
                                placeholder="Type your message..."
                                value="{chat>/currentMessage}"
                                enabled="{= !!${chat>/current_room}}"
                                width="100%"
                                class="sapUiSmallMarginBegin"
                            />

                            <HBox visible="{chat>/isRecording}">
                                <Button
                                    text="{= ${chat>/isPaused} ? 'Resume' : 'Pause' }"
                                    press=".onTogglePauseRecording"
                                    type="Emphasized"
                                    icon="sap-icon://pause"
                                />
                                <Button
                                    text="Stop"
                                    press=".onStopRecordingPress"
                                    type="Reject"
                                    class="sapUiTinyMarginBegin"
                                    icon="sap-icon://stop"
                                />
                            </HBox>
                            <!-- Record -->
                            <Button
                                text=""
                                press=".onRecordAudioPress"
                                visible="{= !${chat>/isRecording} }"
                                type="Accept"
                                icon="sap-icon://microphone"
                                class="sapUiTinyMarginTop"
                            />

                            <Button
                                icon="sap-icon://paper-plane"
                                tooltip="Send message"
                                press="sendMessage"
                                type="Emphasized"
                                class="sapUiSmallMarginBegin"
                                enabled="{= !!${chat>/current_room}}"
                            />
                        </Toolbar>

                        <!-- Attachment Preview -->
                        <!-- <HBox
                            id="attachmentPreview"
                            visible="{= !!${chat>/pendingAttachment} }"
                            class="sapUiTinyMarginBottom sapUiTinyMarginTop sapUiSmallMargin"
                        >
                            <core:Icon
                                src="sap-icon://attachment"
                                class="sapUiTinyMarginEnd"
                            />
                            <Text
                                text="{chat>/pendingAttachment/name}"
                                class="sapUiTinyMarginEnd sapUiSmallText"
                            />
                            <Button
                                icon="sap-icon://decline"
                                type="Transparent"
                                tooltip="Remove attachment"
                                press="onRemoveAttachment"
                                class="sapUiTinyMarginBegin"
                            />
                            <Image
                                src="{chat>/pendingAttachment/preview}"
                                visible="{= ${chat>/pendingAttachment/type}.startsWith('image/') }"
                                width="3rem"
                                height="3rem"
                                class="sapUiTinyMarginEnd sapUiSmallMarginBegin"
                            />
                        </HBox> -->
                    </content>
                </Page>
            </detailPages>
        </SplitApp>

         <Button
            id="scrollDownButton"
            icon="sap-icon://arrow-bottom"
            type="Transparent"
            press=".onScrollToBottom"
            class="floatingButtonDown"
        >
        </Button>
    </Dialog>
</core:FragmentDefinition>
